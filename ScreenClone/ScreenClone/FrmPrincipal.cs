using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;




//C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\.NETFramework\v4.5.1
// ou C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\v3.0
//Pegamos esse assembly da pasta acima,  para fazer a automaçao de telas, buscar algum campo  ou alguma informa
//ção que fica dentro de alguma tela, temos que imotar as dlls UIAutomationClient e UIAtomationTypes
using System.Windows.Automation;
using System.Drawing;

using System.Drawing.Imaging;


namespace ScreenClone
{
    public partial class FrmPrincipal : Form
    {
        //esta assinatura PINVOKE serve para capturar a janela corrente
        [DllImport("user32.dll")]
        private static extern IntPtr GetForegroundWindow();
        private static bool active = false;
        public FrmPrincipal()
        {
            InitializeComponent();
        }
        private void PrintScreen(string name)

        {
            Bitmap printscreen = new Bitmap(Screen.PrimaryScreen.Bounds.Width, Screen.PrimaryScreen.Bounds.Height);
            Graphics graphics = Graphics.FromImage(printscreen as Image);
            graphics.CopyFromScreen(0, 0, 0, 0, printscreen.Size);
            printscreen.Save($"{name}.jpg", ImageFormat.Jpeg);

        }

        private void tmlAbrirTela_Tick(object sender, EventArgs e)
        {
            if (active) return;
            var hwnd = GetForegroundWindow();
            if (!(hwnd.ToInt32() > 0)) return;

            //a partir do endereco da tela, capturamos ela,
            //vamos automatizar (Capturar alguma informação da Janela)
            //a partir do endereço de memória 
            var janela = AutomationElement.FromHandle(hwnd);
            var name = janela.Current.Name;
            PrintScreen(name);
            if (name.Contains("Facebook"))
            {
                active = true;
                var frmFb = new FrmFacebook();
                frmFb.Show();
            }
            return;




        }
    }
}
